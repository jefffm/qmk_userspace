#include "keymap_steno.h"

#include QMK_KEYBOARD_H

enum layers {
    DEF,
    SYM,
    NAV,
    NUM,
    STENO,
};

// layers
#define LA_SYM MO(SYM)
#define LA_NAV MO(NAV)

// oneshot mods
#define OS_LSFT OSM(MOD_LSFT)
#define OS_LALT OSM(MOD_LALT)
#define OS_LCTL OSM(MOD_LCTL)
#define OS_LGUI OSM(MOD_LGUI)
#define OS_RSFT OSM(MOD_RSFT)
#define OS_RALT OSM(MOD_RALT)
#define OS_RCTL OSM(MOD_RCTL)
#define OS_RGUI OSM(MOD_RGUI)

// misc
// #define SSHOT SGUI(KC_S)
// #define UNDO C(KC_Z)
// #define REDO C(S(KC_Z))
// #define CUT C(KC_X)
// #define COPY C(KC_C)
// #define PASTE C(KC_V)
// #define TAB_CLS C(KC_W)
// #define TAB_NEW C(KC_T)
// #define TAB_PREV C(S(KC_TAB))
// #define TAB_NEXT C(KC_TAB)
// #define BACK KC_WBAK
// #define FWD KC_WFWD

#define SSHOT C(S(SGUI(KC_4)))
#define UNDO SGUI(KC_Z)
#define REDO SGUI(S(KC_Z))
#define CUT SGUI(KC_X)
#define COPY SGUI(KC_C)
#define PASTE SGUI(KC_V)
#define TAB_CLS SGUI(KC_W)
#define TAB_NEW SGUI(KC_T)
#define TAB_PREV SGUI(S(KC_TAB))
#define TAB_NEXT SGUI(KC_TAB)
#define BACK KC_WBAK
#define FWD KC_WFWD

// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

  [DEF] = LAYOUT(
// ,-------------------------------------------------------------------------------------------------------------------------------------------------------------------.
    TO(DEF) , KC_NO   , KC_NO   , KC_NO   , KC_NO , KC_NO  , KC_NO , KC_NO , KC_NO , KC_NO , KC_NO , KC_NO   , KC_NO  , KC_NO   , KC_NO   , KC_NO   ,TO(STENO),QK_BOOT ,
// |--------+---------+---------+---------+-------+--------+-------------------------------------------------+--------+---------+---------+---------+--------+---------|
    KC_NO   , KC_NO   , KC_NO   , KC_NO   , KC_NO , KC_NO  ,                                                   KC_NO  , KC_NO   , KC_NO   , KC_NO   , KC_NO  , KC_NO   ,
// |--------+---------+---------+---------+-------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    KC_NO   , KC_QUOT , KC_COMM , KC_DOT  , KC_P  , KC_Y   ,                                                   KC_F   , KC_G    , KC_C    , KC_R    , KC_L   , KC_NO   ,
// |--------+---------+---------+---------+-------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    KC_NO   , KC_A    , KC_O    , KC_E    , KC_U  , KC_I   ,                                                   KC_D   , KC_H    , KC_T    , KC_N    , KC_S   , KC_NO   ,
// |--------+---------+---------+---------+-------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    KC_NO   , KC_SCLN , KC_Q    , KC_J    , KC_K  , KC_X   ,                                                   KC_B   , KC_M    , KC_W    , KC_V    , KC_Z   , KC_NO   ,
// `--------+---------+---------+---------+-------+--------'                                                 `--------+---------+---------+---------+--------+---------'
              KC_NO   , KC_NO   , KC_NO   , KC_NO ,                                                                     KC_NO   , KC_NO   , KC_NO   , KC_NO  ,
//          `-------------------------------------'                                                                   `--------------------------------------'
//                                          ,-------------------.                                        ,--------------------.
                                              OS_LSFT , KC_NO   ,                                          KC_NO   , OS_RSFT  ,
//                                ,---------|---------|---------|                                        |---------+----------+---------.
                                                        KC_NO   ,                                          KC_NO   ,
//                                |         |         |---------|                                        |---------|          |         |
                                    KC_BSPC , LA_NAV  , KC_NO   ,                                          KC_NO   , LA_SYM   , KC_SPC
//                                |         |         |         |                                        |         |          |         |
//                                `-----------------------------'                                        `------------------------------'
  ),

  [SYM] = LAYOUT(
// ,--------------------------------------------------------------------------------------------------------------------------------------------------------------------.
    _______ , _______ , _______ , _______ , _______, _______, _______,_______,_______,_______,_______,_______, _______ , _______ , _______ , _______ , _______, _______ ,
// |--------+---------+---------+---------+--------+--------+-------------------------------------------------+--------+---------+---------+---------+--------+---------|
    _______ , _______ , _______ , _______ , _______, _______,                                                  _______ , _______ , _______ , _______ , _______, _______ ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    _______ , KC_ESC  , KC_LBRC , KC_LCBR , KC_LPRN, KC_TILD,                                                  KC_CIRC , KC_RPRN , KC_RCBR , KC_RBRC , KC_GRV , _______ ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    _______ , KC_MINS , KC_ASTR , KC_EQL  , KC_UNDS, KC_DLR ,                                                  KC_HASH , OS_RSFT , OS_RGUI , OS_RALT , OS_RCTL, _______ ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    _______ , KC_PLUS , KC_PIPE , KC_AT   , KC_SLSH, KC_PERC,                                                  XXXXXXX , KC_BSLS , KC_AMPR , KC_QUES , KC_EXLM, _______ ,
// `--------+---------+---------+---------+--------+--------'                                                 `--------+---------+---------+---------+--------+---------'
              _______ , _______ , _______ , _______,                                                                     _______ , _______ , _______ , _______,
//          `--------------------------------------'                                                                   `--------------------------------------'
//                                          ,-------------------.                                        ,--------------------.
                                              _______ , _______ ,                                          _______ , _______  ,
//                                ,---------|---------|---------|                                        |---------+----------+---------.
                                                        _______ ,                                          _______ ,
//                                |         |         |---------|                                        |---------|          |         |
                                    KC_ESC , _______  , _______ ,                                          _______ , _______  , _______
//                                |         |         |         |                                        |         |          |         |
//                                `-----------------------------'                                        `------------------------------'
  ),

  [NAV] = LAYOUT(
// ,--------------------------------------------------------------------------------------------------------------------------------------------------------------------.
    _______ , _______ , _______ , _______ , _______, _______, _______,_______,_______,_______,_______,_______, _______ , _______ , _______ , _______ , _______, _______ ,
// |--------+---------+---------+---------+--------+--------+-------------------------------------------------+--------+---------+---------+---------+--------+---------|
    _______ , _______ , _______ , _______ , _______, _______,                                                  _______ , _______ , _______ , _______ , _______, _______ ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    _______ , XXXXXXX , XXXXXXX , COPY    , SSHOT  , CUT    ,                                                  KC_TAB  , KC_HOME , KC_UP   , KC_END  , KC_DEL , _______ ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    _______ , OS_LCTL , OS_LALT , OS_LGUI , OS_LSFT, KC_BSPC,                                                  KC_BSPC , KC_LEFT , KC_DOWN , KC_RIGHT, KC_BSPC, _______ ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    _______ , UNDO    , CUT     , COPY    , PASTE  , XXXXXXX,                                                  XXXXXXX , KC_PGDN , KC_PGUP , BACK    , FWD    , _______ ,
// `--------+---------+---------+---------+--------+--------'                                                 `--------+---------+---------+---------+--------+---------'
              _______ , _______ , _______ , _______,                                                                     _______ , _______ , _______ , _______,
//          `--------------------------------------'                                                                   `--------------------------------------'
//                                          ,-------------------.                                        ,--------------------.
                                              _______ , _______ ,                                          _______ , _______  ,
//                                ,---------|---------|---------|                                        |---------+----------+---------.
                                                        _______ ,                                          _______ ,
//                                |         |         |---------|                                        |---------|          |         |
                                    _______ , _______ , _______ ,                                          _______ , _______  , KC_ENT
//                                |         |         |         |                                        |         |          |         |
//                                `-----------------------------'                                        `------------------------------'
  ),

  [NUM] = LAYOUT(
// ,--------------------------------------------------------------------------------------------------------------------------------------------------------------------.
    _______ , _______ , _______ , _______ , _______, _______, _______,_______,_______,_______,_______,_______, _______ , _______ , _______ , _______ , _______, _______ ,
// |--------+---------+---------+---------+--------+--------+-------------------------------------------------+--------+---------+---------+---------+--------+---------|
    _______ , _______ , _______ , _______ , _______, _______,                                                  _______ , _______ , _______ , _______ , _______, _______ ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    _______ , KC_1    , KC_2    , KC_3    , KC_4   , KC_5   ,                                                  KC_6    , KC_7    , KC_8    , KC_9    , KC_0   , _______ ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    _______ , OS_LCTL , OS_LALT , OS_LGUI , OS_LSFT, KC_F6  ,                                                  KC_F7   , OS_RSFT , OS_RGUI , OS_RALT , OS_RCTL, _______ ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    _______ , KC_F1   , KC_F2   , KC_F3   , KC_F4  , KC_F5  ,                                                  KC_F8   , KC_F9   , KC_F10   , KC_F11 , KC_F12 , _______ ,
// `--------+---------+---------+---------+--------+--------'                                                 `--------+---------+---------+---------+--------+---------'
              _______ , _______ , _______ , _______,                                                                     _______ , _______ , _______ , _______,
//          `--------------------------------------'                                                                   `--------------------------------------'
//                                          ,-------------------.                                        ,--------------------.
                                              _______ , _______ ,                                          _______ , _______  ,
//                                ,---------|---------|---------|                                        |---------+----------+---------.
                                                        _______ ,                                          _______ ,
//                                |         |         |---------|                                        |---------|          |         |
                                    _______ , _______ , _______ ,                                          _______ , _______  , _______
//                                |         |         |         |                                        |         |          |         |
//                                `-----------------------------'                                        `------------------------------'
  ),

  [STENO] = LAYOUT(
// ,--------------------------------------------------------------------------------------------------------------------------------------------------------------------.
    _______ , _______ , _______ , _______ , _______, _______, _______,_______,_______,_______,_______,_______, _______ , _______ , _______ , _______ , _______, _______ ,
// |--------+---------+---------+---------+--------+--------+-------------------------------------------------+--------+---------+---------+---------+--------+---------|
    _______ , _______ , _______ , _______ , _______, _______,                                                  _______ , _______ , _______ , _______ , _______, _______ ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    STN_FN  , STN_S1  , STN_TL  , STN_PL  , STN_HL , STN_ST1,                                                  STN_ST3 , STN_FR  , STN_PR  , STN_LR  , STN_TR , STN_DR  ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    STN_PWR , STN_S2  , STN_KL  , STN_WL  , STN_RL , STN_ST2,                                                  STN_ST4 , STN_RR  , STN_BR  , STN_GR  , STN_SR , STN_ZR  ,
// |--------+---------+---------+---------+--------+--------|                                                 |--------+---------+---------+---------+--------+---------|
    _______ , _______ , _______ , _______ , _______, _______,                                                  _______ , _______ , _______ , _______ , _______, _______ ,
// `--------+---------+---------+---------+--------+--------'                                                 `--------+---------+---------+---------+--------+---------'
              _______ , _______ , _______ , _______,                                                                     _______ , _______ , _______ , _______,
//          `--------------------------------------'                                                                   `--------------------------------------'
//                                          ,-------------------.                                        ,--------------------.
                                              STN_N1  , _______ ,                                          _______ , STN_N7   ,
//                                ,---------|---------|---------|                                        |---------+----------+---------.
                                                        _______ ,                                          _______ ,
//                                |         |         |---------|                                        |---------|          |         |
                                    STN_A   , STN_O   , _______ ,                                          _______ , STN_E    , STN_U
//                                |         |         |         |                                        |         |          |         |
//                                `-----------------------------'                                        `------------------------------'
  ),

};
// clang-format on

layer_state_t layer_state_set_user(layer_state_t state) {
    return update_tri_layer_state(state, SYM, NAV, NUM);
}

void matrix_init_user(void) {
    steno_set_mode(STENO_MODE_GEMINI); // or STENO_MODE_BOLT
}

enum combos {
    CMB_CW,
    CMB_ENTER,
    CMB_ESC,
    CMB_CAPS,
};

const uint16_t PROGMEM combo_cw[]    = {KC_QUOT, KC_L, COMBO_END};
const uint16_t PROGMEM combo_enter[] = {KC_H, KC_T, KC_N, COMBO_END};
const uint16_t PROGMEM combo_esc[]   = {KC_O, KC_E, KC_U, COMBO_END};
const uint16_t PROGMEM combo_caps[]  = {KC_SCLN, KC_X, COMBO_END};

// clang-format off
combo_t key_combos[]  = {
    [CMB_CW] = COMBO(combo_cw, CW_TOGG),
    [CMB_ENTER] = COMBO(combo_enter, KC_ENT),
    [CMB_ESC] = COMBO(combo_esc, KC_ESC),
    [CMB_CAPS] = COMBO(combo_caps, KC_CAPS),
};
// clang-format on
